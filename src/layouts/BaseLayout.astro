---
import "../styles/global.css";
import { getCollection } from "astro:content";
// 导入新提取的 Head 组件
import Head from "../components/Head.astro";
import Header from "../components/Header.astro";
import Footer from "../components/Footer.astro";
import FAB from "../components/FAB.tsx";
import Sidebar from "../components/Sidebar.astro";
// 判断是否为文章页面（/posts路径下）
const isPostsPage = Astro.url.pathname.startsWith("/posts");

const site = "Greenhouse between Clouds";
let {
  pageTitle = site,
  postFrontmatter = null,
  ogImage = "/og-default.jpg",
  canonicalUrl = Astro.url.href,
  post = null,
} = Astro.props;

let description = "这是一个使用Astro构建的用来放各种乱七八糟东西的网站";
if (postFrontmatter && postFrontmatter.description) {
  description = postFrontmatter.description;
}
if (postFrontmatter && postFrontmatter.image && postFrontmatter.image.url) {
  ogImage = postFrontmatter.image.url;
}
if (postFrontmatter && postFrontmatter.url) {
  canonicalUrl = Astro.url.origin + postFrontmatter.url;
}
if( postFrontmatter && postFrontmatter.title) {
  pageTitle = `${postFrontmatter.title} | ${site}`;
}

const items = (await getCollection("posts")).map((post) => ({
  title: post.data.title,
  url: `/posts/${post.id}/`,
  depth: post.data.url?.split("/").length - 1 || 0,
}));

const isHome = Astro.url.pathname === "/";
---

<html lang="zh-CN">
  <Head
    pageTitle={pageTitle}
    description={description}
    ogImage={ogImage}
    canonicalUrl={canonicalUrl}
  />

  <body>
    <style>
      .main-content {
        flex: 1;
        max-width: 800px;
        margin: 0 auto;
        width: 100%;
      }
      /* 侧边栏 */
      .blog-post-sidebar {
        width: 280px;
        flex-shrink: 0;
        position: sticky;
        top: 5rem;
        align-self: flex-start;
        max-height: calc(100vh - 4rem);
      }

      .content-container {
        display: flex;
        flex-direction: row;
        margin: 0 auto;
        max-width: 1200px;
      }

      .welcome {
        width: 100%;
        max-width: 1200px;
        margin: 1rem auto;
        height: 400px;
        font-size: 1.1rem;
        color: var(--text-secondary);
      }

      @media (max-width: 968px) {
        .blog-post-sidebar {
          width: 100%;
          position: static;
          order: -1;
          margin-bottom: 2rem;
        }

        .content-container {
          flex-direction: column;
          padding: 0 1rem;
        }
      }
    </style>
    <Header pageTitle={pageTitle} />
    {isHome && <div class="yarare-hero cg" >
    </div>}
    <div style="" class="content-container">
      <main class="main-content">
        <slot />
      </main>
      <aside>
        <div
          class="blog-post-sidebar"
          style={isPostsPage ? "position: static" : ";"}
        >
          <Sidebar post={post}/>
        </div>
        <div class="blog-post-sidebar">
          <slot name="aside" />
        </div>
      </aside>
    </div>
    <Footer />
    <FAB client:only />
  </body>
</html>
