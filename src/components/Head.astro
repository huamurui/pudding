---
// 定义组件接收的 Props 类型及默认值
interface Props {
  pageTitle: string;
  description?: string;
  ogImage?: string;
  canonicalUrl?: string;
  structuredData?: Record<string, unknown>;
}

// 解构 Props 并设置默认值（与原逻辑保持一致）
const {
  pageTitle,
  description = "这是一个使用Astro构建的用来放各种乱七八糟东西的网站",
  ogImage = "/og-default.jpg",
  canonicalUrl = Astro.url.href,
  structuredData = null,
} = Astro.props as Props;

// 站点固定信息（统一维护）
const siteName = "Greenhouse between Clouds";
const siteOgName = "云苔的blog";
const siteKeywords = "云苔,芸薹,huamurui,花木瑞,blog,tech,software,nonsense,chattering,碎碎念,web,front-end";
// 将 JSON-LD 转为字符串并对可能的闭合 </script> 标签进行转义以避免提早结束脚本
const structuredDataHtml = structuredData
  ? JSON.stringify(structuredData).replace(/<\/script/gi, '<\\/script')
  : null;

import { ClientRouter } from "astro:transitions";
---

<head>
  <meta charset="utf-8" />
  <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="generator" content={Astro.generator} />
  <link rel="sitemap" href="/sitemap-index.xml" />

  <title>{pageTitle}</title>
  <meta name="description" content={description} />
  <meta name="keywords" content={siteKeywords} />

  <link rel="canonical" href={canonicalUrl} />

  <meta name="robots" content="index, follow" />
  <meta
    name="googlebot"
    content="index, follow, max-snippet:-1, max-image-preview:large, max-video-preview:-1"
  />

  <meta property="og:title" content={pageTitle} />
  <meta property="og:description" content={description} />
  <meta property="og:type" content="website" />
  <meta property="og:url" content={canonicalUrl} />
  <meta property="og:image" content={ogImage} />
  <meta property="og:site_name" content={siteOgName} />
  <meta property="og:locale" content="zh_CN" />

  <meta name="twitter:card" content="summary_large_image" />
  <meta name="twitter:title" content={pageTitle} />
  <meta name="twitter:description" content={description} />
  <meta name="twitter:image" content={ogImage} />

  <!-- <meta http-equiv="Content-Security-Policy" content="default-src 'self'; script-src 'self' 'unsafe-inline'; style-src 'self' 'unsafe-inline'; img-src 'self' data: https://*; font-src 'self' data:;" /> -->
  <!-- <meta http-equiv="X-XSS-Protection" content="1; mode=block" /> -->
  <!-- <meta http-equiv="X-Content-Type-Options" content="nosniff" /> -->
  <!-- <meta name="referrer" content="strict-origin-when-cross-origin" /> -->

  <meta
    name="theme-color"
    content="#5e7eff"
    media="(prefers-color-scheme: light)"
  />
  <meta
    name="theme-color"
    content="#ff9eb6"
    media="(prefers-color-scheme: dark)"
  />
  {structuredDataHtml && <script type="application/ld+json" set:html={structuredDataHtml}></script>}

  <!-- <link rel="preload" href="/fonts/main-font.woff2" as="font" type="font/woff2" crossorigin /> -->
  <ClientRouter />

  <script is:inline>
    (function () {
      try {
        const savedTheme = localStorage.getItem("theme");
        const systemPrefersDark = window.matchMedia(
          "(prefers-color-scheme: dark)",
        ).matches;
        const theme = savedTheme || (systemPrefersDark ? "dark" : "light");

        document.documentElement.classList.add(theme);
        document.documentElement.setAttribute("data-theme", theme);
      } catch (e) {
        console.error("主题设置错误:", e);
      }
    })();
  </script>

</head>