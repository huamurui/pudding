---
import { getCollection, type CollectionEntry } from "astro:content";
import { siteConfig } from "@/config/site.config";
import type { PostEntry } from "@/types";
import Tag from "./Tag.astro";
import { t } from "@/utils/i18n";

interface Props {
  intro?: string; // ä¸€å¥è¯ç®€ä»‹ï¼ˆå¯é€‰ï¼‰
  post?: PostEntry | null; // post
}

const { intro = siteConfig.description, post = null } = Astro.props as Props;

const allBlogPosts: CollectionEntry<"posts">[] = await getCollection("posts");

const tagCountMap: Map<string, number> = new Map();

allBlogPosts.map((post) => {
  const tags: string[] = Array.isArray(post.data.tags)
    ? post.data.tags
    : post.data.tags
      ? [post.data.tags]
      : [];

  // æ›´æ–°æ ‡ç­¾è®¡æ•°
  tags.forEach((tag) => {
    if (tagCountMap.has(tag)) {
      tagCountMap.set(tag, tagCountMap.get(tag)! + 1);
    } else {
      tagCountMap.set(tag, 1);
    }
  });
});
---

<div class="profile-sidebar">
  <div class="profile-avatar">
    <!-- <img src="/avatar.jpg" alt="ä½ çš„æ˜µç§°" class="avatar-img" /> -->
  </div>
  <h3 class="profile-name">{siteConfig.author.name}</h3>
  <p class="profile-intro">{intro}</p>

  <!-- ç¤¾äº¤é“¾æ¥ -->
  <!-- <div class="profile-social">
    <a href="https://github.com/xxx" aria-label="GitHub">ğŸ”—</a>
    <a href="mailto:xxx@xxx.com" aria-label="é‚®ç®±">ğŸ“§</a>
  </div> -->

  <div class="profile-stats">
    <div class="stat-item">ğŸ“ {allBlogPosts.length} {t('sidebar.stats.posts')}</div>
    <div class="stat-item">ğŸ·ï¸ {Array.from(tagCountMap).length} {t('sidebar.stats.tags')}</div>
    <div class="stat-item">
      {new Date().toISOString().split("T")[0]}
      {t('sidebar.stats.updated')}
    </div>
  </div>
  <Tag post={post} />
</div>

<style>
  .profile-sidebar {
    width: 100%;
    margin: 20px 0;
    display: flex;
    flex-direction: column;
    align-items: center;
    text-align: center;
  }
  .avatar-img {
    width: 80px;
    height: 80px;
    border-radius: 80px;
    object-fit: cover;
  }
</style>
