---
import { getCollection, type CollectionEntry } from "astro:content";

interface Props {
  intro?: string; // ä¸€å¥è¯ç®€ä»‹ï¼ˆå¯é€‰ï¼‰
}

const { intro = "A blog about programming tech and nonsense." } = Astro.props;

const allBlogPosts: CollectionEntry<"posts">[] = await getCollection("posts");

// ç”¨äºç»Ÿè®¡æ ‡ç­¾çš„Map
const tagCountMap: Map<string, number> = new Map();

allBlogPosts.map((post) => {
  // å¤„ç†æ ‡ç­¾ï¼Œç¡®ä¿æ˜¯æ•°ç»„æ ¼å¼
  const tags: string[] = Array.isArray(post.data.tags)
    ? post.data.tags
    : post.data.tag
      ? [post.data.tag]
      : [];

  // æ›´æ–°æ ‡ç­¾è®¡æ•°
  tags.forEach((tag) => {
    if (tagCountMap.has(tag)) {
      tagCountMap.set(tag, tagCountMap.get(tag)! + 1);
    } else {
      tagCountMap.set(tag, 1);
    }
  });
});
---

<div class="profile-sidebar">
  <!-- ä¸ªäººä¿¡æ¯ -->
  <div class="profile-avatar">
    <!-- <img src="/avatar.jpg" alt="ä½ çš„æ˜µç§°" class="avatar-img" /> -->
  </div>
  <h3 class="profile-name">äº‘è‹”</h3>
  <p class="profile-intro">{intro}</p>

  <!-- ç¤¾äº¤é“¾æ¥ -->
  <!-- <div class="profile-social">
    <a href="https://github.com/xxx" aria-label="GitHub">ğŸ”—</a>
    <a href="mailto:xxx@xxx.com" aria-label="é‚®ç®±">ğŸ“§</a>
  </div> -->

  <!-- ç«™ç‚¹ç»Ÿè®¡ -->
  <div class="profile-stats">
    <div class="stat-item">ğŸ“ {allBlogPosts.length} ç¯‡æ–‡ç« </div>
    <div class="stat-item">ğŸ·ï¸ {Array.from(tagCountMap).length} ä¸ªæ ‡ç­¾</div>
    <div class="stat-item">
      <!-- {new Date().toISOString().replace("T", " ").split('.')[0]}  -->
      {new Date().toISOString().split("T")[0]}
      æ›´æ–°
    </div>
  </div>
</div>

<style>
  /* åªå†™å†…å®¹æ ·å¼ï¼Œä¸å†™å®šä½ï¼å®šä½ç”±çˆ¶å¸ƒå±€æ§åˆ¶ */
  .profile-sidebar {
    width: 100%;
    margin: 20px 0;
    display: flex;
    flex-direction: column;
    align-items: center;
    text-align: center;
  }
  .avatar-img {
    width: 80px;
    height: 80px;
    border-radius: 80px;
    object-fit: cover;
  }
  /* å…¶ä»–æ ·å¼çœç•¥... */
</style>
